(()=>{"use strict";function e(e){return function(e){if(Array.isArray(e))return t(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,o){if(e){if("string"==typeof e)return t(e,o);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?t(e,o):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function t(e,t){(null==t||t>e.length)&&(t=e.length);for(var o=0,n=new Array(t);o<t;o++)n[o]=e[o];return n}var o=59,n=sessionStorage.getItem("userUUID");n||(n=uuidv4(),sessionStorage.setItem("userUUID",n)),window.validateFecalElastase=function(){var e=document.getElementById("fecalElastase"),t=e.value.trim();""!==t&&(/^\d{1,3}$/.test(t)||(alert("Fecal elastase test result must be entered as a number between 0 and 999."),e.value=""))},window.showModal=function(e){document.getElementById(e+"Modal").style.display="block"},window.closeModal=function(e){document.getElementById(e+"Modal").style.display="none"},window.validateEnzymeDose=function(e){var t=document.getElementById(e),o=t.value.trim();""!==o&&(/^[1-9]\d*$/.test(o)||(alert("Please enter your dose as a number without commas. For example 36000 rather than 36,000."),t.value=""))};var a={abdominal:["Abdominal pain after you eat","Bloating/distension of your stomach","Excessive gas","Trapped gas","Nausea","Feeling very full for hours after you eat"],toiletRelated:["Messy smelly stools that stick to the side of the toilet bowl","Diarrhea","Constipation","Urgent bowel movement (rush to the toilet)","See fat or oil in stool or on toilet paper","4 or more bowel movements per day"],foodRelated:["I avoid eating large meals","I avoid certain foods or food groups (excluding food allergies or celiac)","I avoid fatty foods"]};function r(e,t){var o={Abdominal:["A-F-Pain","A-F-Bloat","A-F-EGas","A-F-TGas","A-F-Naus","A-F-Full","A-S-Pain","A-S-Bloat","A-S-EGas","A-S-TGas","A-S-Naus","A-S-Full"],"Toilet-related":["T-F-Smell","T-F-Dia","T-F-Const","T-F-Urg","T-F-Fat","T-F-4BM","T-S-Smell","T-S-Dia","T-S-Const","T-S-Urg","T-S-Fat","T-S-4BM"],"Food-related":["F-F-Lrg","F-F-Crtn","F-F-Fat","F-S-Lrg","F-S-Crtn","F-S-Fat"]},n=["Never","At least once, but not regularly","Once a month","Once a week","A few times a week","Most days of the week"],a=["I don't have this symptom","Slightly annoying","Bothersome","Very bothersome"],r=e,i="<h2>".concat(e,' Symptoms - Frequency</h2><table class="symptom-frequency">');i+="<tr><th>Symptom</th><th>Never</th><th>At least once, but not regularly</th><th>Once a month</th><th>Once a week</th><th>A few times a week</th><th>Most days of the week</th></tr>",t.forEach((function(e,t){var a=o[r][t];i+="<tr><td>".concat(e,"</td>");for(var s=0;s<=5;s++)i+='<td><label for="'.concat(a,"_").concat(s,'"><input type="radio" id="').concat(a,"_").concat(s,'" name="').concat(a,'" value="').concat(s,'" ').concat(0===s?"required":"","><span>").concat(n[s],"</span></label></td>");i+="</tr>"})),i+="</table>";var s="<h2>".concat(e,' Symptoms - Severity</h2><table class="symptom-severity">');return s+="<tr><th>Symptom</th><th>I don't have this symptom</th><th>Slightly annoying</th><th>Bothersome</th><th>Very bothersome</th></tr>",t.forEach((function(e,n){var i=o[r][n+t.length];s+="<tr><td>".concat(e,"</td>");for(var l=0;l<=3;l++)s+='<td><label for="'.concat(i,"_").concat(l,'"><input type="radio" id="').concat(i,"_").concat(l,'" name="').concat(i,'" value="').concat(l,'" ').concat(0===l?"required":"","><span>").concat(a[l],"</span></label></td>");s+="</tr>"})),i+(s+="</table>")}function i(e){var t=document.getElementById("epiInfo"),o=t.querySelectorAll("input, select");e?(t.style.display="block",o.forEach((function(e){return e.setAttribute("required","")}))):(t.style.display="none",o.forEach((function(e){return e.removeAttribute("required")})))}function s(e){var t=document.getElementById("enzymeDetails"),o=t.querySelectorAll("input, select");e?(t.style.display="block",o.forEach((function(e){return e.setAttribute("required","")}))):(t.style.display="none",o.forEach((function(e){return e.removeAttribute("required")})))}document.getElementById("abdominalSymptomsSection").innerHTML=r("Abdominal",a.abdominal),document.getElementById("toiletRelatedSymptomsSection").innerHTML=r("Toilet-related",a.toiletRelated),document.getElementById("foodRelatedSymptomsSection").innerHTML=r("Food-related",a.foodRelated),document.addEventListener("DOMContentLoaded",(function(){var t,r,l=document.querySelectorAll('input[name="epiDiagnosis"]'),c=document.querySelectorAll('input[name="takingEnzymes"]'),d=document.getElementById("giSurveyForm"),u=document.querySelector('input[type="submit"]'),m=document.createElement("p");function y(){var e,t,o="Yes"===(null===(e=document.querySelector('input[name="epiDiagnosis"]:checked'))||void 0===e?void 0:e.value),n="Yes"===(null===(t=document.querySelector('input[name="takingEnzymes"]:checked'))||void 0===t?void 0:t.value);o||document.querySelectorAll("#epiInfo input, #epiInfo select").forEach((function(e){return e.removeAttribute("required")})),n||document.querySelectorAll("#enzymeDetails input, #enzymeDetails select").forEach((function(e){return e.removeAttribute("required")})),d.checkValidity()?(u.disabled=!1,u.style.backgroundColor="#4B0082",m.style.display="none"):(u.disabled=!0,u.style.backgroundColor="grey",m.style.display="block")}m.textContent="You are missing some required fields, please review the form and fill out completely.",m.style.color="red",m.style.display="none",d.appendChild(m),l.forEach((function(e){e.addEventListener("change",(function(e){var t="Yes"===e.target.value;i(t),t||document.querySelectorAll("#epiInfo input, #epiInfo select").forEach((function(e){return e.removeAttribute("required")}))}))})),c.forEach((function(e){e.addEventListener("change",(function(e){var t="Yes"===e.target.value;s(t),t||document.querySelectorAll("#enzymeDetails input, #enzymeDetails select").forEach((function(e){return e.removeAttribute("required")}))}))})),i("Yes"===(null===(t=document.querySelector('input[name="epiDiagnosis"]:checked'))||void 0===t?void 0:t.value)),s("Yes"===(null===(r=document.querySelector('input[name="takingEnzymes"]:checked'))||void 0===r?void 0:r.value)),d.addEventListener("input",y),y(),d.addEventListener("submit",(function(t){t.preventDefault(),console.log("Form submit event triggered."),document.getElementById("qrcode");var r=function(){var t=0,o=[],n={Abdominal:["A-F-Pain","A-F-Bloat","A-F-EGas","A-F-TGas","A-F-Naus","A-F-Full","A-S-Pain","A-S-Bloat","A-S-EGas","A-S-TGas","A-S-Naus","A-S-Full"],"Toilet-related":["T-F-Smell","T-F-Dia","T-F-Const","T-F-Urg","T-F-Fat","T-F-4BM","T-S-Smell","T-S-Dia","T-S-Const","T-S-Urg","T-S-Fat","T-S-4BM"],"Food-related":["F-F-Lrg","F-F-Crtn","F-F-Fat","F-S-Lrg","F-S-Crtn","F-S-Fat"]};[].concat(e(a.abdominal.map((function(e,t){return{name:e,abbr:n.Abdominal[t]}}))),e(a.toiletRelated.map((function(e,t){return{name:e,abbr:n["Toilet-related"][t]}}))),e(a.foodRelated.map((function(e,t){return{name:e,abbr:n["Food-related"][t]}})))).forEach((function(e){var n=document.querySelector('input[name="'.concat(e.abbr,'"]:checked')),a=document.querySelector('input[name="'.concat(e.abbr.replace("-F-","-S-"),'"]:checked')),r=n?parseInt(n.value,10):0,i=a?parseInt(a.value,10):0,s=r*i;t+=s,o.push({name:e.name,frequency:r,severity:i,score:s})})),o.sort((function(e,t){return t.score-e.score}));var r=o[2]?o[2].score:null,i=o.filter((function(e){return e.score>=r}));return document.getElementById("scoreDisplay").innerText="EPI/PEI-SS Total Score: ".concat(t),{totalScore:t,symptomScores:o,topSymptoms:i}}(),i=r.totalScore,s=r.symptomScores;r.topSymptoms,p(s);var l=new FormData(t.target),c=l.get("epiDiagnosis"),d=l.get("takingEnzymes"),u={};l.forEach((function(e,t){("No"!==c||"epiDuration"!==t&&"fecalElastase"!==t&&"takingEnzymes"!==t&&"enzymeType"!==t&&"mealDose"!==t&&"snackDose"!==t&&"idealEnzymes"!==t)&&("No"!==d||"enzymeType"!==t&&"mealDose"!==t&&"snackDose"!==t&&"idealEnzymes"!==t)&&(t.includes("-F-")||t.includes("-S-")||(Reflect.has(u,t)?(Array.isArray(u[t])||(u[t]=[u[t]]),u[t].push(e)):u[t]=e))}));var m=document.getElementById("Research").checked?"Yes":"No";u.researchConsent=m,u.totalScore=i;var y={"Abdominal pain after you eat":{frequency:"A-F-Pain",severity:"A-S-Pain"},"Bloating/distension of your stomach":{frequency:"A-F-Bloat",severity:"A-S-Bloat"},"Excessive gas":{frequency:"A-F-EGas",severity:"A-S-EGas"},"Trapped gas":{frequency:"A-F-TGas",severity:"A-S-TGas"},Nausea:{frequency:"A-F-Naus",severity:"A-S-Naus"},"Feeling very full for hours after you eat":{frequency:"A-F-Full",severity:"A-S-Full"},"Messy smelly stools that stick to the side of the toilet bowl":{frequency:"T-F-Smell",severity:"T-S-Smell"},Diarrhea:{frequency:"T-F-Dia",severity:"T-S-Dia"},Constipation:{frequency:"T-F-Const",severity:"T-S-Const"},"Urgent bowel movement (rush to the toilet)":{frequency:"T-F-Urg",severity:"T-S-Urg"},"See fat or oil in stool or on toilet paper":{frequency:"T-F-Fat",severity:"T-S-Fat"},"4 or more bowel movements per day":{frequency:"T-F-4BM",severity:"T-S-4BM"},"I avoid eating large meals":{frequency:"F-F-Lrg",severity:"F-S-Lrg"},"I avoid certain foods or food groups (excluding food allergies or celiac)":{frequency:"F-F-Crtn",severity:"F-S-Crtn"},"I avoid fatty foods":{frequency:"F-F-Fat",severity:"F-S-Fat"}};function p(e){var t=document.getElementById("topSymptomsDisplay");t.innerHTML="";var o=document.createElement("p");o.textContent="Here are the individual symptoms you reported experiencing in order of score (frequency times severity):",o.style.fontStyle="italic",t.appendChild(o),e.forEach((function(e){if(e.score>0){var o=document.createElement("div");o.classList.add("symptom-container");var n=document.createElement("div");n.textContent=e.name,n.classList.add("symptom-label"),o.appendChild(n);var a=document.createElement("div");a.classList.add("symptom-bar"),o.appendChild(a);var r=e.score/15*100,i=document.createElement("div");i.classList.add("score-dot"),i.textContent=e.score,i.style.left="calc(".concat(r,"% - 15px)"),a.appendChild(i),t.appendChild(o)}}))}function h(e){var t,n=document.getElementById("scoreDisplay2"),a=document.getElementById("scoreDisplay3");t=e>o?"above":e<o?"below":"at";var r="<p><strong>What does the EPI/PEI-SS Total Score mean?</strong></p><p>Your total score (".concat(e,') is based on how you reported the burden of severity and frequency of each symptom. There are 15 symptoms, each with a possible score of up to 15, which adds up to a total score possible of 225.</p>\n            <p><strong>Has the EPI/PEI-SS been validated?</strong></p>\n            <p>EPI/PEI-SS is in the process of being validated as a screening tool. To date, <a href="https://doi.org/10.3390/epidemiologia6030048" target="_blank">one study</a> has been done in a real-world population with people already diagnosed with EPI. In people already diagnosed with EPI and already taking treatment for EPI (which is called pancreatic enzyme replacement therapy, PERT), the average EPI/PEI-SS total score was around 98. In contrast, in the group without a diagnosis of EPI, the average EPI/PEI-SS total score was around 38.</p>\n            <p>If we use a cutoff score of ').concat(o," – meaning if your score is ").concat(o," or higher – this suggests that ").concat(81," of 100 people with scores greater than or equal to ").concat(o," will likely have EPI. This concept is called sensitivity. In contrast, estimates for specificity suggest that ").concat(75," of 100 people who do not have EPI will correctly be identified as likely not having it.</p>\n            <p><strong>What should I do with my EPI/PEI-SS score?</strong></p>\n            <p><strong>TLDR:</strong> Your EPI/PEI-SS total score is ").concat(e,", which is ").concat(t," the cutoff of ").concat(o,". This means that ");r+=e>=o?'<strong style="color: #4B0082;">if you are bothered by your GI symptoms, you may want to speak to your doctor about being screened for EPI.</strong></p>':"it is less likely that you may have EPI. However, it is possible to have a lower score and still have EPI. If you are concerned and bothered by your symptoms, you may want to speak to your doctor about your screening options.</p>",document.getElementById("pdfButton").classList.remove("hidden"),n.innerHTML=r,a.innerHTML="<p>The most common screening for EPI is a non-invasive stool test called a fecal elastase test. If you are already taking enzymes, you do not have to discontinue them for the fecal elastase test.</p>"}s.forEach((function(e){var t=y[e.name];t&&(u["".concat(t.frequency,"_Frequency")]=e.frequency,u["".concat(t.severity,"_Severity")]=e.severity,u["".concat(t.frequency,"_Total_Score")]=e.score)})),Object.assign(u,{timestamp:(new Date).toISOString(),geo:l.get("geo"),age:l.get("age"),gender:l.get("gender"),conditions:l.getAll("condition[]"),epiDiagnosis:c,epiDuration:l.get("epiDuration")||"",fecalElastase:l.get("fecalElastase")||"",takingEnzymes:d,enzymeType:l.get("enzymeType")||"",mealDose:l.get("mealDose")||"",snackDose:l.get("snackDose")||"",idealEnzymes:l.get("idealEnzymes")||"",totalScore:i,symptomScores:s,uuid:n}),fetch("https://calm-plateau-06427.herokuapp.com/epi-pei-ss",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(u)}).then((function(e){if(e.ok)return e.json();throw new Error("Network response was not ok.")})).then((function(e){console.log("Form data successfully submitted:",e),p(s),h(i)})).catch((function(e){console.error("There was a problem with the fetch operation:",e)})),h(i),/Mobi|Android/i.test(navigator.userAgent)?(g.classList.remove("hidden"),f.classList.add("hidden")):(f.classList.remove("hidden"),g.classList.add("hidden")),window.printReport=function(){var e=window.jspdf.jsPDF;html2canvas(document.querySelector("#scoreDisplay")).then((function(t){html2canvas(document.querySelector("#topSymptomsDisplay")).then((function(o){html2canvas(document.querySelector("#scoreDisplay2")).then((function(n){var a=new e({orientation:"portrait",unit:"px",format:"letter"}),r=a.internal.pageSize.getWidth(),i=(r-40)/t.width,s=(r-40)/o.width,l=(r-40)/n.width,c=Math.min(i,s,l);a.addImage(t,"JPEG",20,20,t.width*c,t.height*c),a.addImage(o,"JPEG",20,t.height*c+40,o.width*c,o.height*c),a.addImage(n,"JPEG",20,(t.height+o.height)*c+60,n.width*c,n.height*c),a.save("EPI-PEI-SS-report.pdf")}))}))})).catch((function(e){console.error("Error capturing canvas elements:",e)}))}}));var p=document.getElementById("Research"),h=document.getElementById("conditionalText");p.addEventListener("change",(function(){this.checked?h.style.display="none":h.style.display="block"})),p.checked||(h.style.display="block");var f=document.getElementById("pdfButton"),g=document.getElementById("screenshotMessage")}))})();